//地区数据来自百度开发者中心 http://dev2.baidu.com/newdev2/dist/index.html#/content/?pageType=1&productlineId=12&nodeId=377&pageId=264&url=&qq-pf-to=pcqq.c2c
let str = "全部地域 9999999 北京 1000  上海 2000  天津 3000  广东 4000  福建 5000  海南 8000  安徽 9000  贵州 10000  甘肃 11000  广西 12000  河北 13000  河南 14000  黑龙江 15000  湖北 16000  湖南 17000  吉林 18000  江苏 19000  江西 20000  辽宁 21000  内蒙古 22000  宁夏 23000  青海 24000  山东 25000  山西 26000  陕西 27000  四川 28000  西藏 29000  新疆 30000  云南 31000  浙江 32000  重庆 33000  香港 34000  台湾 35000  澳门 36000  日本 200000  其他国家（除日本外） 300000  潮州 4085  东莞 4116  佛山 4090  广州 4084  河源 4115  惠州 4117  江门 4082  揭阳 4083  茂名 4086  梅州 4088  清远 4089  汕头 4091  汕尾 4092  韶关 4094  深圳 4093  阳江 4109  云浮 4111  湛江 4110  肇庆 4114  中山 4112  珠海 4113  福州 5081  龙岩 5050  南平 5049  宁德 5051  莆田 5048  泉州 5052  三明 5066  厦门 5070  漳州 5080  白沙黎族自治县 8493  保亭黎族苗族自治县 8488  昌江黎族自治县 8492  澄迈县 8487  儋州 8303  定安县 8484  东方 8296  海口 8302  乐东黎族自治县 8490  临高县 8491  陵水黎族自治县 8486  琼海 8297  琼中黎族苗族自治县 8489  三亚 8298  屯昌县 8485  万宁 8301  文昌 8299  五指山 8300  安庆 9128  蚌埠 9141  亳州 9143  巢湖 9129  池州 9130  滁州 9131  阜阳 9140  合肥 9142  淮北 9127  淮南 9133  黄山 9132  六安 9135  马鞍山 9134  铜陵 9138  芜湖 9139  宿州 9137  宣城 9136  安顺 10119  毕节 10124  贵阳 10118  六盘水 10120  黔东南 10122  黔南 10121  黔西南 10123  铜仁 10125  遵义 10126  白银 11267  定西 11263  甘南 11477  嘉峪关 11257  金昌 11256  酒泉 11255  兰州 11258  临夏 11261  陇南 11259  平凉 11260  庆阳 11262  天水 11265  武威 11264  张掖 11266  百色 12108  北海 12104  崇左 12478  防城港 12098  贵港 12096  桂林 12095  河池 12106  贺州 12107  来宾 12100  柳州 12101  南宁 12099  钦州 12102  梧州 12103  玉林 12105  保定 13304  沧州 13305  承德 13306  邯郸 13330  衡水 13332  廊坊 13307  秦皇岛 13325  石家庄 13327  唐山 13329  邢台 13326  张家口 13331  安阳 14309  鹤壁 14323  济源 14476  焦作 14308  开封 14310  洛阳 14311  漯河 14312  南阳 14315  平顶山 14313  濮阳 14316  三门峡 14321  商丘 14320  新乡 14317  信阳 14318  许昌 14319  郑州 14322  周口 14324  驻马店 14314  大庆 15342  大兴安岭 15343  哈尔滨 15335  鹤岗 15344  黑河 15345  鸡西 15333  佳木斯 15334  牡丹江 15336  七台河 15338  齐齐哈尔 15337  双鸭山 15340  绥化 15339  伊春 15341  鄂州 16377  恩施 16366  黄冈 16349  黄石 16348  荆门 16346  荆州 16347  潜江 16364  神农架 16368  十堰 16369  随州 16367  天门 16373  武汉 16371  仙桃 16372  咸宁 16375  襄阳 16370  孝感 16365  宜昌 16376  常德 17351  郴州 17353  衡阳 17360  怀化 17350  娄底 17354  邵阳 17355  湘潭 17356  湘西 17357  益阳 17359  永州 17362  岳阳 17361  张家界 17358  长沙 17352  株洲 17363  白城 18039  白山 18042  吉林 18038  辽源 18041  四平 18043  松原 18044  通化 18045  延边 18047  长春 18040  常州 19054  淮安 19053  连云港 19057  南京 19055  南通 19056  苏州 19059  泰州 19061  无锡 19062  宿迁 19060  徐州 19058  盐城 19063  扬州 19064  镇江 19065  抚州 20078  赣州 20077  吉安 20068  景德镇 20069  九江 20067  南昌 20072  萍乡 20071  上饶 20074  新余 20073  宜春 20075  鹰潭 20076  鞍山 21151  本溪 21145  朝阳 21147  大连 21155  丹东 21144  抚顺 21152  阜新 21150  葫芦岛 21157  锦州 21146  辽阳 21148  盘锦 21149  沈阳 21153  铁岭 21154  营口 21156  阿拉善盟 22159  巴彦淖尔 22162  包头 22169  赤峰 22158  鄂尔多斯 22168  呼和浩特 22167  呼伦贝尔 22166  通辽 22161  乌海 22164  乌兰察布 22163  锡林郭勒盟 22165  兴安盟 22160  固原 23170  石嘴山 23171  吴忠 23172  银川 23174  中卫 23173  果洛 24496  海北 24494  海东 24176  海南 24479  海西 24177  黄南 24495  西宁 24175  玉树 24178  滨州 25223  德州 25200  东营 25220  菏泽 25222  济南 25196  济宁 25197  莱芜 25198  聊城 25199  临沂 25201  青岛 25202  日照 25203  泰安 25208  威海 25218  潍坊 25204  烟台 25219  枣庄 25221  淄博 25207  大同 26217  晋城 26205  晋中 26206  临汾 26211  吕梁 26210  朔州 26213  太原 26214  忻州 26212  阳泉 26215  运城 26216  长治 26209  安康 27240  宝鸡 27239  汉中 27248  商洛 27241  铜川 27242  渭南 27243  西安 27244  咸阳 27245  延安 27246  榆林 27249  阿坝 28252  巴中 28247  成都 28226  达州 28250  德阳 28232  甘孜 28236  广安 28224  广元 28225  乐山 28233  凉山 28228  泸州 28234  眉山 28227  绵阳 28229  南充 28231  内江 28235  攀枝花 28230  遂宁 28237  雅安 28251  宜宾 28254  资阳 28238  自贡 28253  阿里 29498  昌都 29480  拉萨 29269  林芝 29270  那曲 29268  日喀则 29271  山南 29497  阿克苏 30185  阿拉尔 30499  阿勒泰 30182  巴音郭楞 30191  博尔塔拉 30180  昌吉 30181  哈密 30179  和田 30195  喀什 30183  克拉玛依 30184  克孜勒苏柯尔克孜 30186  石河子 30187  塔城 30188  图木舒克 30500  吐鲁番 30190  乌鲁木齐 30192  五家渠 30189  伊犁 30193  保山 31289  楚雄 31283  大理 31292  德宏 31286  迪庆 31482  红河 31293  昆明 31284  丽江 31285  临沧 31287  怒江 31481  普洱 31290  曲靖 31288  文山 31291  西双版纳 31483  玉溪 31295  昭通 31294  杭州 32280  湖州 32282  嘉兴 32273  金华 32272  丽水 32275  宁波 32276  衢州 32274  绍兴 32277  台州 32279  温州 32278  舟山 32281 ";
let phrase = /[\u4e00-\u9fa5|\uff08|\uff09]+.?\d+/g
//创建数据
let long = str.match(phrase)
let region = long.map((item)=>{
   return item.split(/\s+/)
})
region = region.map((item)=>{
   item[1]=~~item[1]
   return item
})


// 树
class Node{
  constructor(arr,parent=null){
    this.id =arr[1]
    this.region = arr[0]
    this.indeterminate=false
    this.checkAll = false
    this.children = []
    this.checkedGroup = []
    this.parent = parent;
    this.data = []
  }
  //递归获取数据
  getData(head){
    if(this.children.length!=0){
      this.children.forEach((item)=>{
        item.getData(head)
      })
    }else{
      head.data.concat(this.checkedGroup)
    }
  }
  //状态管理，checkAll为true indeterminate为false ✔
  //checkAll为false indeterminate为true ——
  //checkAll为false indeterminate为false 口
  //不存在同真
  isCheck(){
    if(this.indeterminate){
      this.checkAll=false
    }else{
      this.checkAll=!this.checkAll
    }
    return this.checkAll
  }
  //递归查询下级indeterminate状态
  childrenIndeterminate(){
    if(this.children.length==0){
        return false
    }else{
      let re = false
      for(let i =0;i< this.children.length;i++){
          re = re || this.children[i].indeterminate
      }
      return re
    }
  }
  //四种管理checkedGroup的方法
  setGroup(type,region){
    if(type=="fill"){
        if(this.children.length){
            this.children.forEach((item)=>{
                this.setGroup("add",item.region)
            })
        }
    }else if(type=="delete"){
        if(this.checkedGroup.includes(region)){
            this.checkedGroup.splice(this.checkedGroup.indexOf(region),1)
        }
    }else if(type=="add"){
        if(!this.checkedGroup.includes(region)){
            this.checkedGroup.push(region)
        }
    }else if(type=="clear"){
        this.checkedGroup=[]
    }
  }
  //改变checkedGroup checkAll向下传递
  getCheckDown(){
    if(this.checkAll){
      this.setGroup("fill")
    }else{
      this.setGroup("clear")
    }
    if(this.children.length!=0){
      this.children.forEach((item)=>{
        item.checkAll = this.checkAll
        item.getCheckDown(item)
      })
    }
}
//indeterminate向下传递
getIndeterDown(){
  if(this.children.length>0){
    this.children.forEach((item)=>{
        item.indeterminate=false
        item.getIndeterDown()
    })
  }
}
//indeterminate向上传递
getIndeterUp(){
  this.indeterminate = ((this.checkedGroup.length > 0 ) && (this.checkedGroup.length < this.children.length)) || (this.childrenIndeterminate())
  if(this.parent!=null){
    this.parent.getIndeterUp()
  }
}
//根据checkgroup改变checkAll checkAll向上传递
getCheckUp(){
  if(this.parent!=null){
    if(this.checkAll){
      this.parent.setGroup("add",this.region)
    }else{
      this.parent.setGroup("delete",this.region);
    }
    if(this.parent.checkedGroup.length == this.parent.children.length){
      this.parent.checkAll = true
      this.parent.getCheckUp()
    }else{
      this.parent.checkAll = false
      this.parent.getCheckUp()
    }
  }
}
//核心，状态被改变时通过这个函数分发事件来管理状态
  changingCheck(){
    alert(this.region)
    if(this.parent==null){
      this.isCheck()
      this.getCheckDown()
      this.getIndeterDown()
      this.getIndeterUp()
    }else if(this.children.length==0){
      this.isCheck()
      this.getCheckDown()
      this.getCheckUp()
      this.getIndeterDown()
      this.getIndeterUp()
    }else{
      this.isCheck()
      this.getCheckDown()
      this.getCheckUp()
      this.getIndeterDown()
      this.getIndeterUp()
    }
  }
}

//创建状态树实例
let tree = new Node(region[0])
function completeTree(tree){
    //一级地区
    tree.children.push(new Node(["中国",0],tree))
    tree.children.push(new Node(["国外",null],tree))
    //二级国内地区
    let huabei = new Node(["华北地区",1],tree.children[0])
    let dongbei = new Node(["东北地区",2],tree.children[0])
    let huadong = new Node(["华东地区",3],tree.children[0])
    let huazhong = new Node(["华中地区",4],tree.children[0])
    let huanan = new Node(["华南地区",5],tree.children[0])
    let xinan = new Node(["西南地区",6],tree.children[0])
    let xibei = new Node(["西北地区",7],tree.children[0])
    let qita  = new Node(["其他地区",0],tree.children[0])
    tree.children[0].children.push(huabei)
    tree.children[0].children.push(dongbei)
    tree.children[0].children.push(huadong)
    tree.children[0].children.push(huazhong)
    tree.children[0].children.push(huanan)
    tree.children[0].children.push(xinan)
    tree.children[0].children.push(xibei)
    tree.children[0].children.push(qita)
    for(let i = 0;i<region.length;i++){
      let item = region[i]
      if(item[1]>100000&&item[1]<400000){
        //二级国外地区
        tree.children[1].children.push(new Node(item,tree.children[1]))
      }else if(item[1]%1000==0){
        //三级国内地区，省对应到地区
        switch(Math.floor(item[1]/1000)){
          //huabei
          case 1:
             huabei.children.push(new Node(item,huabei));
          break;
          case 3:
             huabei.children.push(new Node(item,huabei));
          break;
          case 13:
             huabei.children.push(new Node(item,huabei));
          break;
          case 22:
             huabei.children.push(new Node(item,huabei));
          break;
          case 26:
             huabei.children.push(new Node(item,huabei));
          break;
          //dongbei
          case 15:
            dongbei.children.push(new Node(item,dongbei))
          break;
          case 18:
            dongbei.children.push(new Node(item,dongbei))
          break;
          case 21:
            dongbei.children.push(new Node(item,dongbei))
          break
          //huadong
          case 2:
             huadong.children.push(new Node(item,huadong))
          break;
          case 5:
             huadong.children.push(new Node(item,huadong))
          break;
          case 9:
             huadong.children.push(new Node(item,huadong))
          break;
          case 19:
             huadong.children.push(new Node(item,huadong))
          break;
          case 20:
             huadong.children.push(new Node(item,huadong))
          break;
          case 25:
             huadong.children.push(new Node(item,huadong))
          break;
          case 32:
             huadong.children.push(new Node(item,huadong))
          break;
          //huazhong
          case 14:
             huazhong.children.push(new Node(item,huazhong))
          break;
          case 16:
             huazhong.children.push(new Node(item,huazhong))
          break;
          case 17:
             huazhong.children.push(new Node(item,huazhong))
          break;
          //huanan
          case 4:
             huanan.children.push(new Node(item,huanan))
          break;
          case 8:
             huanan.children.push(new Node(item,huanan))
          break;
          case 12:
             huanan.children.push(new Node(item,huanan))
          break;
          //xinan
          case 10:
             xinan.children.push(new Node(item,xinan))
          break;
          case 28:
             xinan.children.push(new Node(item,xinan))
          break;
          case 29:
             xinan.children.push(new Node(item,xinan))
          break;
          case 31:
             xinan.children.push(new Node(item,xinan))
          break;
          case 33:
             xinan.children.push(new Node(item,xinan))
          break;
          //xibei
          case 11:
            xibei.children.push(new Node(item,xibei))
          break;
          case 23:
            xibei.children.push(new Node(item,xibei))
          break;
          case 24:
            xibei.children.push(new Node(item,xibei))
          break;
          case 27:
            xibei.children.push(new Node(item,xibei))
          break;
          case 30:
            xibei.children.push(new Node(item,xibei))
          break;
          //qita
          case 34:
             qita.children.push(new Node(item,qita))
          break;
          case 35:
             qita.children.push(new Node(item,qita))
          break;
          case 36:
             qita.children.push(new Node(item,qita))
          break;
        }
      }else{
        //四级国内地区，市对应到省
        let areas = tree.children[0].children;
        for(let i=0 ;i< 8;i++){
          let provinces = areas[i].children;
          for(let j = 0;j<provinces.length;j++){
            let province = provinces[j],isBreak=false;
            if(item[1]-province.id<1000&&item[1]-province.id>0){
              province.children.push(new Node(item,province))
              isBreak=true;
              break
            }
            if(isBreak) break
          }
        }
      }
    }
}
completeTree(tree)





export default tree;